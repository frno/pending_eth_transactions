use serde::{Serialize, Deserialize};
use web3::types::Transaction;

#[derive(Debug, Clone, PartialEq, Deserialize, Serialize)]
pub struct PendingTransactionSubscription {
    pub jsonrpc: String,
    pub method: String,
    pub params: PendingTransactionSubscriptionParams,
}

#[derive(Debug, Clone, PartialEq, Deserialize, Serialize)]
pub struct PendingTransactionSubscriptionParams {
    #[serde(rename = "result")]
    pub transaction: Transaction,
    pub subscription: String,
}

#[cfg(test)]
mod pending_transaction_message_tests {
    use crate::alchemy_pending_transactions_messages::{from_json, PendingTransactionSubscription};
    use crate::convert_to_address;

    #[test]
    fn deserialize_json() {
        let json = r#"{"jsonrpc":"2.0","method":"eth_subscription","params":{"result":{"blockHash":null,"blockNumber":null,"from":"0x8193e0d565c7d2cad12aea4b2d7b8bef5a106461","gas":"0x381ad","gasPrice":"0x1961a34ef3","maxFeePerGas":"0x1961a34ef3","maxPriorityFeePerGas":"0x59682f00","hash":"0xe226fd342d8fc00ab08e14689c332eb563497e9180f16a0880281e4ca47c7376","input":"0xab834bab0000000000000000000000007be8076f4ea4a4ad08075c2508e481d6c946d12b0000000000000000000000008193e0d565c7d2cad12aea4b2d7b8bef5a106461000000000000000000000000312a2ec07ff3a446ad63ee03a39b1f89d083138e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c36cf0cfcb5d905b8b513860db0cfe63f6cf9f5c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007be8076f4ea4a4ad08075c2508e481d6c946d12b000000000000000000000000312a2ec07ff3a446ad63ee03a39b1f89d083138e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000005b3256965e7c3cf26e11fcaf296dfc8807c01073000000000000000000000000c36cf0cfcb5d905b8b513860db0cfe63f6cf9f5c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001f400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000028f0815ec767000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000061b230490000000000000000000000000000000000000000000000000000000000000000b6c60272b2a4092806d8bfc629b80dbcbe6148a52a5042f69e829cf9e114dc7100000000000000000000000000000000000000000000000000000000000001f400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000028f0815ec767000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000061b19e070000000000000000000000000000000000000000000000000000000061b2efcd356327841f332da4853cd38367ed208a7ac6cf03af81b3b25df83a68bbfcb9020000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006a000000000000000000000000000000000000000000000000000000000000007a000000000000000000000000000000000000000000000000000000000000008a000000000000000000000000000000000000000000000000000000000000009a00000000000000000000000000000000000000000000000000000000000000aa00000000000000000000000000000000000000000000000000000000000000ac0000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000001cd18a11c5d5e21f75780324b5094c532d3a5e41817bd181956c0f62753fa006343aee180c2e2e2c0042d798b89e829bd3d88a8a5bffc06b4eda7e5c0692f52787d18a11c5d5e21f75780324b5094c532d3a5e41817bd181956c0f62753fa006343aee180c2e2e2c0042d798b89e829bd3d88a8a5bffc06b4eda7e5c0692f52787000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c4f242432a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000008193e0d565c7d2cad12aea4b2d7b8bef5a106461000000000000000000000000000001ae00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c4f242432a000000000000000000000000312a2ec07ff3a446ad63ee03a39b1f89d083138e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001ae00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c400000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c4000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","nonce":"0x85","to":"0x7be8076f4ea4a4ad08075c2508e481d6c946d12b","transactionIndex":null,"value":"0x28f0815ec7670000","type":"0x2","accessList":[],"chainId":"0x1","v":"0x1","r":"0x7e005e1efd8b25719d64ed474b9ee3e9bf0a67a7b3a9bff8ae3c5f5e1e1f8d95","s":"0x6e6aaede46a19bd1ba72631b87c8724f54d7df10e4e56f7ee275cec8fbaa1f1b"},"subscription":"0x3a47ded3853653b9e915085d664a8cf5"}}"#;
        let subscribe: PendingTransactionSubscription = from_json(json).unwrap();
        assert_eq!(subscribe.jsonrpc, "2.0");
        assert_eq!(subscribe.method, "eth_subscription");
        let transaction = subscribe.params.transaction;
        assert_eq!(transaction.to.unwrap(), convert_to_address("0x7be8076f4ea4a4ad08075c2508e481d6c946d12b").unwrap());
    }
}